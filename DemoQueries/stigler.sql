-- Install data first 

DROP TABLE IF EXISTS nutrients CASCADE;

CREATE TABLE nutrients (
  nid           INT,
  name  	varchar(100),
  unit          varchar(10),
  PRIMARY KEY ( nid )
  );

DROP TABLE IF EXISTS allowance CASCADE;
CREATE TABLE allowance (
  nid           INT references nutrients(nid),
  value         float4,
  PRIMARY KEY ( nid )
);

DROP TABLE IF EXISTS commodities CASCADE;
CREATE TABLE commodities (
  cid	   INT,
  name     varchar(100),
  unit     varchar(10),
  price         float4,
  weight        float4,
  PRIMARY KEY ( cid )
  );

DROP TABLE IF EXISTS  cnvalues CASCADE;
CREATE TABLE cnvalues (
  cid           INT references commodities(cid),
  nid           INT references nutrients(nid),
  value         float4,
  PRIMARY KEY ( cid, nid )
);

INSERT INTO nutrients (nid, name, unit)
VALUES
(1, 'Calories', '1000'),
(2, 'Protein', 'grams'),
(3, 'Calcium', 'grams'),
(4, 'Iron', 'milligrams'),
(5, 'VitaminA', '1000 IE'),
(6, 'Thiamine, Vit. B1', 'milligrams'),
(7, 'Riboflavin, Vit. B2', 'milligrams'),
(8, 'Niacin (Nicotinic Acid)', 'milligrams'),
(9, 'Ascorbic Acid, Vit. C', 'milligrams');

INSERT INTO allowance (nid, value)
VALUES
(1, 3),
(2, 70),
(3, 0.8),
(4, 12),
(5, 5),
(6, 1.8),
(7, 2.7),
(8, 18),
(9, 75);

INSERT INTO commodities (cid, name, unit, price, weight)
VALUES
(1,'Wheat Flour (Enriched)','10 lb.',36,12600),
(2,'Macaroni','1 lb.',14.1,3217),
(3,'Wheat Cereal (Enriched)','28 oz.',24.2,3280),
(4,'Corn Flakes','8 oz.',7.1,3194),
(5,'Corn Meal','1 lb.',4.6,9861),
(6,'Hominy Grits','24 oz.',8.5,8005),
(7,'Rice','1 lb.',7.5,6048),
(8,'Rolled Oats','1 lb.',7.1,6389),
(9,'White Bread (Enriched)','1 lb.',7.9,5742),
(10,'Whole Wheat Bread','1 lb.',9.1,4985),
(11,'Rye Bread','1 lb.',9.2,4930),
(12,'Pound Cake','1 lb.',24.8,1829),
(13,'Soda Crackers','1 lb.',15.1,3004),
(14,'Milk','1 qt.',11,8867),
(15,'Evaporated Milk (can)','14.5 oz.',6.7,6035),
(16,'Butter','1 lb.',20.8,1473),
(17,'Oleomargarine','1 lb.',16.1,2817),
(18,'Eggs','1 doz.',32.6,1857),
(19,'Cheese (Cheddar)','1 lb.',24.2,1874),
(20,'Cream','1/2 pt.',14.1,1689),
(21,'Peanut Butter','1 lb.',17.9,2534),
(22,'Mayonnaise','1/2 pt.',16.7,1198),
(23,'Crisco','1 lb.',20.3,2234),
(24,'Lard','1 lb.',9.8,4628),
(25,'Sirloin Steak','1 lb.',39.6,1145),
(26,'Round Steak','1 lb.',36.4,1246),
(27,'Rib Roast','1 lb.',29.2,1553),
(28,'Chuck Roast','1 lb.',22.6,2007),
(29,'Plate','1 lb.',14.6,3107),
(30,'Liver (Beef)','1 lb.',26.8,1692),
(31,'Leg of Lamb','1 lb.',27.6,1643),
(32,'Lamb Chops (Rib)','1 lb.',36.6,1239),
(33,'Pork Chops','1 lb.',30.7,1477),
(34,'Pork Loin Roast','1 lb.',24.2,1874),
(35,'Bacon','1 lb.',25.6,1772),
(36,'Ham - smoked','1 lb.',27.4,1655),
(37,'Salt Pork','1 lb.',16,2835),
(38,'Roasting Chicken','1 lb.',30.3,1497),
(39,'Veal Cutlets','1 lb.',42.3,1072),
(40,'Salmon, Pink (can)','16 oz.',13,3489),
(41,'Apples','1 lb.',4.4,9072),
(42,'Bananas','1 lb.',6.1,4982),
(43,'Lemons','1 doz.',26,2380),
(44,'Oranges','1 doz.',30.9,4439),
(45,'Green Beans','1 lb.',7.1,5750),
(46,'Cabbage','1 lb.',3.7,8949),
(47,'Carrots','1 bunch',4.7,6080),
(48,'Celery','1 stalk',7.3,3915),
(49,'Lettuce','1 head',8.2,2247),
(50,'Onions','1 lb.',3.6,11844),
(51,'Potatoes','15 lb.',34,16810),
(52,'Spinach','1 lb.',8.1,4592),
(53,'Sweet Potatoes','1 lb.',5.1,7649),
(54,'Peaches (can)','No. 2 1/2',16.8,4894),
(55,'Pears (can)','No. 2 1/2',20.4,4030),
(56,'Pineapple (can)','No. 2 1/2',21.3,3993),
(57,'Asparagus (can)','No. 2',27.7,1945),
(58,'Grean Beans (can)','No. 2',10,5386),
(59,'Pork and Beans (can)','16 oz.',7.1,6389),
(60,'Corn (can)','No. 2',10.4,5452),
(61,'Peas (can)','No. 2',13.8,4109),
(62,'Tomatoes (can)','No. 2',8.6,6263),
(63,'Tomato Soup (can)','10 1/2 oz.',7.6,3917),
(64,'Peaches, Dried','1 lb.',15.7,2889),
(65,'Prunes, Dried','1 lb.',9,4284),
(66,'Raisins, Dried','15 oz.',9.4,4524),
(67,'Peas, Dried','1 lb.',7.9,5742),
(68,'Lima Beans, Dried','1 lb.',8.9,5097),
(69,'Navy Beans, Dried','1 lb.',5.9,7688),
(70,'Coffee','1 lb.',22.4,2025),
(71,'Tea','1/4 lb.',17.4,652),
(72,'Cocoa','8 oz.',8.6,2637),
(73,'Chocolate','8 oz.',16.2,1400),
(74,'Sugar','10 lb.',51.7,8773),
(75,'Corn Sirup','24 oz.',13.7,4996),
(76,'Molasses','18 oz.',13.6,3752),
(77,'Strawberry Preserve','1 lb.',20.5,2213);

INSERT INTO cnvalues(cid, nid, value)
VALUES
(1,1,44.7),
(1,2,1411),
(1,3,2),
(1,4,365),
(1,5,0),
(1,6,55.4),
(1,7,33.3),
(1,8,441),
(1,9,0),
(2,1,11.6),
(2,2,418),
(2,3,0.7),
(2,4,54),
(2,5,0),
(2,6,3.2),
(2,7,1.9),
(2,8,68),
(2,9,0),
(3,1,11.8),
(3,2,377),
(3,3,14.4),
(3,4,175),
(3,5,0),
(3,6,14.4),
(3,7,8.8),
(3,8,114),
(3,9,0),
(4,1,11.4),
(4,2,252),
(4,3,0.1),
(4,4,56),
(4,5,0),
(4,6,13.5),
(4,7,2.3),
(4,8,68),
(4,9,0),
(5,1,36),
(5,2,897),
(5,3,1.7),
(5,4,99),
(5,5,30.9),
(5,6,17.4),
(5,7,7.9),
(5,8,106),
(5,9,0),
(6,1,28.6),
(6,2,680),
(6,3,0.8),
(6,4,80),
(6,5,0),
(6,6,10.6),
(6,7,1.6),
(6,8,110),
(6,9,0),
(7,1,21.2),
(7,2,460),
(7,3,0.6),
(7,4,41),
(7,5,0),
(7,6,2),
(7,7,4.8),
(7,8,60),
(7,9,0),
(8,1,25.3),
(8,2,907),
(8,3,5.1),
(8,4,341),
(8,5,0),
(8,6,37.1),
(8,7,8.9),
(8,8,64),
(8,9,0),
(9,1,15.6),
(9,2,488),
(9,3,2.5),
(9,4,115),
(9,5,0),
(9,6,13.8),
(9,7,8.5),
(9,8,126),
(9,9,0),
(10,1,12.2),
(10,2,484),
(10,3,2.7),
(10,4,125),
(10,5,0),
(10,6,13.9),
(10,7,6.4),
(10,8,160),
(10,9,0),
(11,1,12.4),
(11,2,439),
(11,3,1.1),
(11,4,82),
(11,5,0),
(11,6,9.9),
(11,7,3),
(11,8,66),
(11,9,0),
(12,1,8),
(12,2,130),
(12,3,0.4),
(12,4,31),
(12,5,18.9),
(12,6,2.8),
(12,7,3),
(12,8,17),
(12,9,0),
(13,1,12.5),
(13,2,288),
(13,3,0.5),
(13,4,50),
(13,5,0),
(13,6,0),
(13,7,0),
(13,8,0),
(13,9,0),
(14,1,6.1),
(14,2,310),
(14,3,10.5),
(14,4,18),
(14,5,16.8),
(14,6,4),
(14,7,16),
(14,8,7),
(14,9,177),
(15,1,8.4),
(15,2,422),
(15,3,15.1),
(15,4,9),
(15,5,26),
(15,6,3),
(15,7,23.5),
(15,8,11),
(15,9,60),
(16,1,10.8),
(16,2,9),
(16,3,0.2),
(16,4,3),
(16,5,44.2),
(16,6,0),
(16,7,0.2),
(16,8,2),
(16,9,0),
(17,1,20.6),
(17,2,17),
(17,3,0.6),
(17,4,6),
(17,5,55.8),
(17,6,0.2),
(17,7,0),
(17,8,0),
(17,9,0),
(18,1,2.9),
(18,2,238),
(18,3,1),
(18,4,52),
(18,5,18.6),
(18,6,2.8),
(18,7,6.5),
(18,8,1),
(18,9,0),
(19,1,7.4),
(19,2,448),
(19,3,16.4),
(19,4,19),
(19,5,28.1),
(19,6,0.8),
(19,7,10.3),
(19,8,4),
(19,9,0),
(20,1,3.5),
(20,2,49),
(20,3,1.7),
(20,4,3),
(20,5,16.9),
(20,6,0.6),
(20,7,2.5),
(20,8,0),
(20,9,17),
(21,1,15.7),
(21,2,661),
(21,3,1),
(21,4,48),
(21,5,0),
(21,6,9.6),
(21,7,8.1),
(21,8,471),
(21,9,0),
(22,1,8.6),
(22,2,18),
(22,3,0.2),
(22,4,8),
(22,5,2.7),
(22,6,0.4),
(22,7,0.5),
(22,8,0),
(22,9,0),
(23,1,20.1),
(23,2,0),
(23,3,0),
(23,4,0),
(23,5,0),
(23,6,0),
(23,7,0),
(23,8,0),
(23,9,0),
(24,1,41.7),
(24,2,0),
(24,3,0),
(24,4,0),
(24,5,0.2),
(24,6,0),
(24,7,0.5),
(24,8,5),
(24,9,0),
(25,1,2.9),
(25,2,166),
(25,3,0.1),
(25,4,34),
(25,5,0.2),
(25,6,2.1),
(25,7,2.9),
(25,8,69),
(25,9,0),
(26,1,2.2),
(26,2,214),
(26,3,0.1),
(26,4,32),
(26,5,0.4),
(26,6,2.5),
(26,7,2.4),
(26,8,87),
(26,9,0),
(27,1,3.4),
(27,2,213),
(27,3,0.1),
(27,4,33),
(27,5,0),
(27,6,0),
(27,7,2),
(27,8,0),
(27,9,0),
(28,1,3.6),
(28,2,309),
(28,3,0.2),
(28,4,46),
(28,5,0.4),
(28,6,1),
(28,7,4),
(28,8,120),
(28,9,0),
(29,1,8.5),
(29,2,404),
(29,3,0.2),
(29,4,62),
(29,5,0),
(29,6,0.9),
(29,7,0),
(29,8,0),
(29,9,0),
(30,1,2.2),
(30,2,333),
(30,3,0.2),
(30,4,139),
(30,5,169.2),
(30,6,6.4),
(30,7,50.8),
(30,8,316),
(30,9,525),
(31,1,3.1),
(31,2,245),
(31,3,0.1),
(31,4,20),
(31,5,0),
(31,6,2.8),
(31,7,3),
(31,8,86),
(31,9,0),
(32,1,3.3),
(32,2,140),
(32,3,0.1),
(32,4,15),
(32,5,0),
(32,6,1.7),
(32,7,2.7),
(32,8,54),
(32,9,0),
(33,1,3.5),
(33,2,196),
(33,3,0.2),
(33,4,80),
(33,5,0),
(33,6,17.4),
(33,7,2.7),
(33,8,60),
(33,9,0),
(34,1,4.4),
(34,2,249),
(34,3,0.3),
(34,4,37),
(34,5,0),
(34,6,18.2),
(34,7,3.6),
(34,8,79),
(34,9,0),
(35,1,10.4),
(35,2,152),
(35,3,0.2),
(35,4,23),
(35,5,0),
(35,6,1.8),
(35,7,1.8),
(35,8,71),
(35,9,0),
(36,1,6.7),
(36,2,212),
(36,3,0.2),
(36,4,31),
(36,5,0),
(36,6,9.9),
(36,7,3.3),
(36,8,50),
(36,9,0),
(37,1,18.8),
(37,2,164),
(37,3,0.1),
(37,4,26),
(37,5,0),
(37,6,1.4),
(37,7,1.8),
(37,8,0),
(37,9,0),
(38,1,1.8),
(38,2,184),
(38,3,0.1),
(38,4,30),
(38,5,0.1),
(38,6,0.9),
(38,7,1.8),
(38,8,68),
(38,9,46),
(39,1,1.7),
(39,2,156),
(39,3,0.1),
(39,4,24),
(39,5,0),
(39,6,1.4),
(39,7,2.4),
(39,8,57),
(39,9,0),
(40,1,5.8),
(40,2,705),
(40,3,6.8),
(40,4,45),
(40,5,3.5),
(40,6,1),
(40,7,4.9),
(40,8,209),
(40,9,0),
(41,1,5.8),
(41,2,27),
(41,3,0.5),
(41,4,36),
(41,5,7.3),
(41,6,3.6),
(41,7,2.7),
(41,8,5),
(41,9,544),
(42,1,4.9),
(42,2,60),
(42,3,0.4),
(42,4,30),
(42,5,17.4),
(42,6,2.5),
(42,7,3.5),
(42,8,28),
(42,9,498),
(43,1,1),
(43,2,21),
(43,3,0.5),
(43,4,14),
(43,5,0),
(43,6,0.5),
(43,7,0),
(43,8,4),
(43,9,952),
(44,1,2.2),
(44,2,40),
(44,3,1.1),
(44,4,18),
(44,5,11.1),
(44,6,3.6),
(44,7,1.3),
(44,8,10),
(44,9,1993),
(45,1,2.4),
(45,2,138),
(45,3,3.7),
(45,4,80),
(45,5,69),
(45,6,4.3),
(45,7,5.8),
(45,8,37),
(45,9,862),
(46,1,2.6),
(46,2,125),
(46,3,4),
(46,4,36),
(46,5,7.2),
(46,6,9),
(46,7,4.5),
(46,8,26),
(46,9,5369),
(47,1,2.7),
(47,2,73),
(47,3,2.8),
(47,4,43),
(47,5,188.5),
(47,6,6.1),
(47,7,4.3),
(47,8,89),
(47,9,608),
(48,1,0.9),
(48,2,51),
(48,3,3),
(48,4,23),
(48,5,0.9),
(48,6,1.4),
(48,7,1.4),
(48,8,9),
(48,9,313),
(49,1,0.4),
(49,2,27),
(49,3,1.1),
(49,4,22),
(49,5,112.4),
(49,6,1.8),
(49,7,3.4),
(49,8,11),
(49,9,449),
(50,1,5.8),
(50,2,166),
(50,3,3.8),
(50,4,59),
(50,5,16.6),
(50,6,4.7),
(50,7,5.9),
(50,8,21),
(50,9,1184),
(51,1,14.3),
(51,2,336),
(51,3,1.8),
(51,4,118),
(51,5,6.7),
(51,6,29.4),
(51,7,7.1),
(51,8,198),
(51,9,2522),
(52,1,1.1),
(52,2,106),
(52,3,0),
(52,4,138),
(52,5,918.4),
(52,6,5.7),
(52,7,13.8),
(52,8,33),
(52,9,2755),
(53,1,9.6),
(53,2,138),
(53,3,2.7),
(53,4,54),
(53,5,290.7),
(53,6,8.4),
(53,7,5.4),
(53,8,83),
(53,9,1912),
(54,1,3.7),
(54,2,20),
(54,3,0.4),
(54,4,10),
(54,5,21.5),
(54,6,0.5),
(54,7,1),
(54,8,31),
(54,9,196),
(55,1,3),
(55,2,8),
(55,3,0.3),
(55,4,8),
(55,5,0.8),
(55,6,0.8),
(55,7,0.8),
(55,8,5),
(55,9,81),
(56,1,2.4),
(56,2,16),
(56,3,0.4),
(56,4,8),
(56,5,2),
(56,6,2.8),
(56,7,0.8),
(56,8,7),
(56,9,399),
(57,1,0.4),
(57,2,33),
(57,3,0.3),
(57,4,12),
(57,5,16.3),
(57,6,1.4),
(57,7,2.1),
(57,8,17),
(57,9,272),
(58,1,1),
(58,2,54),
(58,3,2),
(58,4,65),
(58,5,53.9),
(58,6,1.6),
(58,7,4.3),
(58,8,32),
(58,9,431),
(59,1,7.5),
(59,2,364),
(59,3,4),
(59,4,134),
(59,5,3.5),
(59,6,8.3),
(59,7,7.7),
(59,8,56),
(59,9,0),
(60,1,5.2),
(60,2,136),
(60,3,0.2),
(60,4,16),
(60,5,12),
(60,6,1.6),
(60,7,2.7),
(60,8,42),
(60,9,218),
(61,1,2.3),
(61,2,136),
(61,3,0.6),
(61,4,45),
(61,5,34.9),
(61,6,4.9),
(61,7,2.5),
(61,8,37),
(61,9,370),
(62,1,1.3),
(62,2,63),
(62,3,0.7),
(62,4,38),
(62,5,53.2),
(62,6,3.4),
(62,7,2.5),
(62,8,36),
(62,9,1253),
(63,1,1.6),
(63,2,71),
(63,3,0.6),
(63,4,43),
(63,5,57.9),
(63,6,3.5),
(63,7,2.4),
(63,8,67),
(63,9,862),
(64,1,8.5),
(64,2,87),
(64,3,1.7),
(64,4,173),
(64,5,86.8),
(64,6,1.2),
(64,7,4.3),
(64,8,55),
(64,9,57),
(65,1,12.8),
(65,2,99),
(65,3,2.5),
(65,4,154),
(65,5,85.7),
(65,6,3.9),
(65,7,4.3),
(65,8,65),
(65,9,257),
(66,1,13.5),
(66,2,104),
(66,3,2.5),
(66,4,136),
(66,5,4.5),
(66,6,6.3),
(66,7,1.4),
(66,8,24),
(66,9,136),
(67,1,20),
(67,2,1367),
(67,3,4.2),
(67,4,345),
(67,5,2.9),
(67,6,28.7),
(67,7,18.4),
(67,8,162),
(67,9,0),
(68,1,17.4),
(68,2,1055),
(68,3,3.7),
(68,4,459),
(68,5,5.1),
(68,6,26.9),
(68,7,38.2),
(68,8,93),
(68,9,0),
(69,1,26.9),
(69,2,1691),
(69,3,11.4),
(69,4,792),
(69,5,0),
(69,6,38.4),
(69,7,24.6),
(69,8,217),
(69,9,0),
(70,1,0),
(70,2,0),
(70,3,0),
(70,4,0),
(70,5,0),
(70,6,4),
(70,7,5.1),
(70,8,50),
(70,9,0),
(71,1,0),
(71,2,0),
(71,3,0),
(71,4,0),
(71,5,0),
(71,6,0),
(71,7,2.3),
(71,8,42),
(71,9,0),
(72,1,8.7),
(72,2,237),
(72,3,3),
(72,4,72),
(72,5,0),
(72,6,2),
(72,7,11.9),
(72,8,40),
(72,9,0),
(73,1,8),
(73,2,77),
(73,3,1.3),
(73,4,39),
(73,5,0),
(73,6,0.9),
(73,7,3.4),
(73,8,14),
(73,9,0),
(74,1,34.9),
(74,2,0),
(74,3,0),
(74,4,0),
(74,5,0),
(74,6,0),
(74,7,0),
(74,8,0),
(74,9,0),
(75,1,14.7),
(75,2,0),
(75,3,0.5),
(75,4,74),
(75,5,0),
(75,6,0),
(75,7,0),
(75,8,5),
(75,9,0),
(76,1,9),
(76,2,0),
(76,3,10.3),
(76,4,244),
(76,5,0),
(76,6,1.9),
(76,7,7.5),
(76,8,146),
(76,9,0),
(77,1,6.4),
(77,2,11),
(77,3,0.4),
(77,4,7),
(77,5,0.2),
(77,6,0.2),
(77,7,0.4),
(77,8,3),
(77,9,0);





-- For a moderately active man weighing 154 pounds, 
-- how much of each of 77 foods should be eaten on 
-- a daily basis so that the man’s intake of nine nutrients 
-- will be at least equal to the recommended dietary allowances (RDAs) 
-- suggested by the National Research Council in 1943, with the cost of the diet being minimal?

-- Calculate yealy expenditure, for commodities
SELECT c.cid, c.name, exp_daily*365.25 as exp_yearly FROM (

 -- Find daily expenditures for each commodit
 SOLVESELECT exp_daily IN (SELECT cid, name, NULL::float4 AS exp_daily 
			   FROM commodities) AS t
 -- Minimize the daily expenditures
 MINIMIZE (SELECT sum(exp_daily) FROM t)
 SUBJECTTO 
     -- We do not allow negative expenditues     
    (SELECT exp_daily >= 0 FROM t),

     -- We want allowances to be met for each nutrients
    (SELECT sum(v.value * exp_daily) >= (SELECT value 
					 FROM allowance a
					 WHERE a.nid = v.nid)
     FROM t INNER JOIN cnvalues v ON t.cid = v.cid 
     GROUP BY v.nid)
     
 USING solverlp) AS s  
 INNER JOIN commodities AS c ON s.cid = c.cid
WHERE exp_daily>0;